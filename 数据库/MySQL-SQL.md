### SQL

#### 1、关系型和非关系型数据库的区别你了解多少？

关系型数据库的优点：

1. 容易理解，因为它采用了关系模型来组织数据
2. 可以保持数据的一致性
3. 数据更新的开销比较小
4. 支持复杂查询（带where子句的查询）

非关系型数据库的优点：

1.  不需要经过SQL层的解析，读写效率高
2. 基于键值对，数值的扩展性很好
3. 可以支持多种类型数据的存储，如图片，文档等。

#### 2、什么是非关系型数据库？

非关系型数据库也叫NOSQL，采用键值对的形式进行存储。

他的读写性很高，易于扩展，可分为内存性数据库和文档型数据库，比如Redis、Mongodb、HBase等。

适合使用非关系型数据库的场景：

① 日志系统

② 地理位置存储

③ 数据量巨大

④ 高可用

#### **3、介绍一下数据库分页**

MySQL中可以使用limit进行分页查询，如：

```sql
-- 在所有的查询结果中，返回前5行记录。 
SELECT prod_name FROM products LIMIT 5; 
-- 在所有的查询结果中，从第5行开始，返回5行记录。 
SELECT prod_name FROM products LIMIT 5,5;
```

总之，带一个值的LIMIT总是从第一行开始，给出的数为返回的行数。带两个值的LIMIT可以指定从行号

为第一个值的位置开始。

<u>优化LIMIT分页：</u>

在偏移量非常大的时候，例如 LIMIT 10000,20 这样的查询，这时MySQL需要查询10020条记录然后

只返回最后20条，前面的10000条记录都将被抛弃，这样的代价是非常高的。如果所有的页面被访问的频率都相同，那么这样的查询平均需要访问半个表的数据。要优化这种查询：

1. 要么是在页面中限制分页的数量，要么是优化大偏移量的性能。
2. 使用索引覆盖扫描，而不是查询所有的列，然后根据需要做一次关联操作再返回所需的列。

#### 4、介绍一下SQL中的聚合函数

常用的聚合函数有COUNT()、AVG()、SUM()、MAX()、MIN()，下面以MySQL为例，说明这些函数的作

用。

<u>COUNT()函数：</u> 

COUNT()函数统计数据表中包含的记录行的总数，或者根据查询结果返回列中包含的数据行数，它有两种用法：

- COUNT(*)计算表中总的行数，不管某列是否有数值或者为空值。
- COUNT(字段名)计算指定列下总的行数，计算时将忽略空值的行。

COUNT()函数可以与GROUP BY一起使用来计算每个分组的总和。

<u>AVG()函数()：</u> 

AVG()函数通过计算返回的行数和每一行数据的和，求得指定列数据的平均值。

AVG()函数可以与GROUP BY一起使用，来计算每个分组的平均值。

<u>SUM()函数：</u>

SUM()是一个求总和的函数，返回指定列值的总和。

SUM()可以与GROUP BY一起使用，来计算每个分组的总和。

<u>MAX()函数：</u>

MAX()返回指定列中的最大值。

MAX()也可以和GROUP BY关键字一起使用，求每个分组中的最大值。

MAX()函数不仅适用于查找数值类型，也可应用于字符类型。

<u>MIN()函数：</u>

MIN()返回查询列中的最小值。

MIN()也可以和GROUP BY关键字一起使用，求出每个分组中的最小值。

MIN()函数与MAX()函数类似，不仅适用于查找数值类型，也可应用于字符类型。

#### 5、**表跟表是怎么关联的？**

表与表之间常用的关联方式有两种：内连接、外连接，以MySQL为例来说明这两种连接方式。

**内连接：**内连接通过INNER JOIN来实现，它将返回两张表中满足连接条件的数据，不满足条件的数据不会查询出来。

**外连接：**外连接通过OUTER JOIN来实现，它会返回两张表中满足连接条件的数据，同时返回不满足连接条件的数据。外连接有两种形式：左外连接（LEFT OUTER JOIN）、右外连接（RIGHT OUTER JOIN）。

- **左外连接：**可以简称为左连接（LEFT JOIN），它会返回左表中的所有记录和右表中满足连接条件的记录。
- **右外连接：**可以简称为右连接（RIGHT JOIN），它会返回右表中的所有记录和左表中满足连接条件的记录。

除此之外，还有一种常见的连接方式：等值连接。这种连接是通过WHERE子句中的条件，将两张表连接在一起，它的实际效果等同于内连接。出于语义清晰的考虑，一般更建议使用内连接，而不是等值连接。

以上是从语法上来说明表与表之间关联的实现方式，而**从表的关系上来说**，比较**常见的关联关系有：**<u>一对多关联、多对多关联、自关联</u>。

- 一对多关联：这种关联形式最为常见，**一般是两张表具有主从关系，并且以主表的主键关联从表的外键来实现这种关联关系。**另外，以从表的角度来看，它们是具有多对一关系的，所以不再赘述多对一关联了。
- 多对多关联：这种关联关系比较复杂，**如果两张表具有多对多的关系，那么它们之间需要有一张中间表来作为衔接，以实现这种关联关系。**这个中间表要设计两列，分别存储那两张表的主键。因此，这两张表中的任何一方，都与中间表形成了一对多关系，从而在这个中间表上建立起了多对多关系。
- 自关联：**自关联就是一张表自己与自己相关联，为了避免表名的冲突，需要在关联时通过别名将它们当做两张表来看待。**一般在表中数据具有层级（树状）时，可以采用自关联一次性查询出多层级的数据。

#### 6、**说一说你对外连接的了解**

外连接通过OUTER JOIN来实现，它会返回两张表中满足连接条件的数据，同时返回不满足连接条件的

数据。常见的外连接有两种形式：左外连接（LEFT OUTER JOIN）、右外连接（RIGHT OUTER

JOIN）。

- 左外连接：可以简称为左连接（LEFT JOIN），它会返回左表中的所有记录和右表中满足连接条件的记录。
- 右外连接：可以简称为右连接（RIGHT JOIN），它会返回右表中的所有记录和左表中满足连接条件的记录。

实际上，外连接还有一种形式：完全外连接（FULL OUTER JOIN），但MySQL不支持这种形式。

#### 7、**说一说数据库的左连接和右连接**

外连接通过OUTER JOIN来实现，它会返回两张表中满足连接条件的数据，同时返回不满足连接条件的

数据。常见的外连接有两种形式：左外连接（LEFT OUTER JOIN）、右外连接（RIGHT OUTER

JOIN）。

- 左外连接：可以简称为左连接（LEFT JOIN），它会返回左表中的所有记录和右表中满足连接条件的记录。
- 右外连接：可以简称为右连接（RIGHT JOIN），它会返回右表中的所有记录和左表中满足连接条件的记录。

#### 8、谈谈你对SQL注入的理解

- SQL注入的原理是将SQL代码伪装到输入参数中，传递到服务器解析并执行的一种攻击手法。也就是说，在一些对SERVER端发起的请求参数中植入一些SQL代码，SERVER端在执行SQL操作时，会拼接对应参数，同时也将一些SQL注入攻击的“SQL”拼接起来，导致会执行一些预期之外的操作。

**如何解决SQL注入**

1. 严格的参数校验

- 参数校验就没得说了，在一些不该有特殊字符的参数中提前进行特殊字符校验即可。

2. SQL预编译

- 在知道了SQL注入的原理之后，我们同样也了解到MySQL有预编译的功能，指的是在服务器启动时，MySQL Client把SQL语句的模板（变量采用占位符进行占位）发送给MySQL服务器，MySQL服务器对SQL语句的模板进行编译，编译之后根据语句的优化分析对相应的索引进行优化，在最终绑定参数时把相应的参数传送给MySQL服务器，直接进行执行，节省了SQL查询时间，以及MySQL服务器的资源，达到一次编译、多次执行的目的，除此之外，还可以防止SQL注入。具体是怎样防止SQL注入的呢？实际上当将绑定的参数传到MySQL服务器，MySQL服务器对参数进行编译，即填充到相应的占位符的过程中，做了转义操作。我们常用的JDBC就有预编译功能，不仅提升性能，而且防止SQL注入。

#### 8、**将一张表的部分数据更新到另一张表，该如何操作呢？**

可以采用关联更新的方式，将一张表的部分数据，更新到另一张表内。参考如下代码：

```sql
update b set b.col=a.col from a,b where a.id=b.id; 
update b set col=a.col from b inner join a on a.id=b.id; 
update b set b.col=a.col from b left Join a on b.id = a.id;
```

#### 9、 WHERE和HAVING有什么区别？

WHERE是一个约束声明，使用WHERE约束来自数据库的数据，WHERE是在结果返回之前起作用的，

WHERE中不能使用聚合函数。

HAVING是一个过滤声明，是在查询返回结果集以后对查询结果进行的过滤操作，在HAVING中可以使

用聚合函数。另一方面，HAVING子句中不能使用除了分组字段和聚合函数之外的其他字段。

从性能的角度来说，HAVING子句中如果使用了分组字段作为过滤条件，应该替换成WHERE子句。因为

WHERE可以在执行分组操作和计算聚合函数之前过滤掉不需要的数据，性能会更好。

#### 10、SQL语法中内连接、自连接、外连接（左、右、全）、交叉连接的区别分别是什么？

内连接：只有两个元素表相匹配的才能在结果集中显示。 

外连接： 

- 左外连接: 左边为驱动表，驱动表的数据全部显示，匹配表的不匹配的不会显示。 
- 右外连接:右边为驱动表，驱动表的数据全部显示，匹配表的不匹配的不会显示。 
- 全外连接：连接的表中不匹配的数据全部会显示出来。 
- 交叉连接： 笛卡尔效应，显示的结果是链接表数的乘积。





